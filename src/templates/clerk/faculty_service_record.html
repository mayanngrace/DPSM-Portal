{% extends "layout.html" %} {% block add_faculty_account %}

<h5>{{faculty_name}}</h5>

{% for sy, fsr_record in fsr_dict.items() %}
    {% set outer_loop = loop %}
    <h4 class="header header{{outer_loop.index}}" onclick='header_click("{{outer_loop.index}}")'>A.Y. {{sy}}</h4>
    {% for record in fsr_record %}
        <table id="fsr_table{{outer_loop.index}}" style="display:none;">
            <tr>
                <th class="sortable">Course Code</th>
                <th>Section</th>
                <th class="sortable">Semester</th>
                <th>Schedule</th>
                <th>No. of Students</th>
                <th>Syllabus</th>
                <th>SET</th>
                <th>Action</th>
            </tr>
            <tr id="row{{outer_loop.index}}_{{outer_loop.index}}_{{loop.index}}">
                <td id="course_code_row{{outer_loop.index}}_{{loop.index}}">{{record['course_code']}}</td>
                <td id="section_row{{outer_loop.index}}_{{loop.index}}">{{record['section']}}</td>
                <td id="semester_row{{outer_loop.index}}_{{loop.index}}">{{record['semester']}}</td>
                <td id="schedule_row{{outer_loop.index}}_{{loop.index}}">{{record['schedule']}}</td>
                <td id="number_of_students_row{{outer_loop.index}}_{{loop.index}}">{{record['number_students']}}</td>
                <td id="syllabus_row{{outer_loop.index}}_{{loop.index}}">Button Here</td>
                <td id="set_row{{outer_loop.index}}_{{loop.index}}">{{record['fsr_score']}}</td>
                <td id="action_button_row{{outer_loop.index}}_{{loop.index}}">
                    <button class="btn btn-primary crud-btn" id="edit_button{{outer_loop.index}}_{{loop.index}}" style="margin-right: 20px;" onclick="edit_row('{{outer_loop.index}}_{{loop.index}}')">Edit</button>
                    <button class="btn btn-primary crud-btn" id="save_button{{outer_loop.index}}_{{loop.index}}" style="margin-right: 20px; display:none;" onclick="save_row('{{outer_loop.index}}_{{loop.index}}')">Save</button>
                </td>
            </tr>
        </table>
    {% endfor %}
    <br>
{% endfor %}
<div class="col-12">
    <hr>
    <h5>Add Faculty Load</h5>
    <div class="col col-12 container">
        <div class="row">
            <div class="col-12 col-lg-2 custom-col-1 mb-3">
                <input class="form-control" type="text"  id="new_course_code" placeholder="Course Code" required>
            </div>
            <div class="col-12 col-lg-1 custom-col-1 mb-3">
                <input class="form-control" type="text" id="new_section" placeholder="Section" >
            </div>
            <div class="col-12 col-lg-2 custom-col-1 mb-3">
                <select class="form-control semester" id="new_semester" required>
                    <option selected value="">Semester</option>
                    <option value="1st Semester">1st Semester</option>
                    <option value="2nd Semester">2nd Semester</option>
                    <option value="Mid Year">Mid Year</option>
                </select>
            </div>
            <div class="col-12 col-lg-2 custom-col-1 mb-3">
                <input class="form-control" type="text" id="new_schedule" placeholder="Schedule" required>
            </div>
            <div class="col-12 col-lg-2 custom-col-1 mb-3">
                <input class="form-control" type="text"  id="new_number_students" placeholder="No. of Students" required>
            </div>
            <div class="col-12 col-lg-2 custom-col-1 mb-3">
                <input class="form-control" type="text"  id="new_syllabus" placeholder="Syllabus" required>
            </div>
            <div class="col-12 col-lg-1 custom-col-1 mb-3">
                <input class="form-control" type="text"  id="new_set" placeholder="SET" required>
            </div>
        </div>
    </div>
</div>

<div class="d-flex justify-content-end mt-2 mr-3">
    <button class="btn btn-primary crud-btn" onclick="add_row();">Add</button> 
</div>

<style>
    table {
        border-collapse: collapse;
        width: 100%;
    }

    th, td {
        text-align: left;
        padding: 8px;
    }

    tr:nth-child(odd) {
        background-color: #769888;
    } 

    th.sortable{
        cursor: pointer;
    }

    th.sortable:hover{
        background-color: white;
    }

    .header {
        padding-left: 10px;
        padding-top: 5px;
        padding-bottom: 5px;
        text-align: left;
        margin-bottom: 0px;
        background: #014421;
        color: white;
    }
</style>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>
    function edit_row(no) {
        document.getElementById("edit_button"+no).style.display="none";
        document.getElementById("save_button"+no).style.display="block";
            
        var course_code=document.getElementById("course_code_row"+no);
        var section=document.getElementById("section_row"+no);
        var semester=document.getElementById("semester_row"+no);
        var schedule=document.getElementById("schedule_row"+no);
        var number_of_students=document.getElementById("number_of_students_row"+no);
        var syllabus=document.getElementById("syllabus_row"+no);
        var set=document.getElementById("set_row"+no);          
        
        var course_code_data=course_code.innerHTML;
        var section_data=section.innerHTML;
        var semester_data=semester.innerHTML;
        var schedule_data=schedule.innerHTML;
        var number_of_students_data=number_of_students.innerHTML;
        var syllabus_data=syllabus.innerHTML;
        var set_data=set.innerHTML;

        course_code.innerHTML="<input style='width: 80%' type='text' id='course_code_text"+no+"' value='"+course_code_data+"'>";
        section.innerHTML="<input type='text' style='width: 40%' id='section_text"+no+"' value='"+section_data+"'>";
        semester.innerHTML="<select id='semester_text"+no+"' value='"+semester_data+"'>"+
                                "<option value='1st Semester'>1st Semester</option>"+
                                "<option value='2nd Semester'>2nd Semester</option>"+
                                "<option value='Mid Year'>Mid Year</option>";
        schedule.innerHTML="<input style='width: 100%' type='text' id='schedule_text"+no+"' value='"+schedule_data+"'>";
        number_of_students.innerHTML="<input style='width: 20%' type='text' id='number_of_students_text"+no+"' value='"+number_of_students_data+"'>";
        syllabus.innerHTML="<input style='width: 40%' type='text' id='syllabus_text"+no+"' value='"+syllabus_data+"'>";
        set.innerHTML="<input style='width: 30%' type='text' id='set_text"+no+"' value='"+set_data+"'>";
    }

    function save_row(no) {
        var course_code_val=document.getElementById("course_code_text"+no).value;
        var section_val=document.getElementById("section_text"+no).value;
        var semester_val=document.getElementById("semester_text"+no).value;
        var schedule_val=document.getElementById("schedule_text"+no).value;
        var number_of_students_val=document.getElementById("number_of_students_text"+no).value;
        var syllabus_val=document.getElementById("syllabus_text"+no).value;
        var set_val=document.getElementById("set_text"+no).value;

        document.getElementById("course_code_row"+no).innerHTML=course_code_val;
        document.getElementById("section_row"+no).innerHTML=section_val;
        document.getElementById("semester_row"+no).innerHTML=semester_val;
        document.getElementById("schedule_row"+no).innerHTML=schedule_val;
        document.getElementById("number_of_students_row"+no).innerHTML=number_of_students_val;
        document.getElementById("syllabus_row"+no).innerHTML=syllabus_val;
        document.getElementById("set_row"+no).innerHTML=set_val;

        document.getElementById("edit_button"+no).style.display="block";
        document.getElementById("save_button"+no).style.display="none";
    }

    function add_row() {
        var new_course_code=document.getElementById("new_course_code").value;
        var new_section=document.getElementById("new_section").value;
        var new_semester=document.getElementById("new_semester").value;
        var new_schedule=document.getElementById("new_schedule").value;
        var new_number_students=document.getElementById("new_number_students").value;
        var new_syllabus=document.getElementById("new_syllabus").value;
        var new_set=document.getElementById("new_set").value;
        
        var table=document.getElementById("fsr_table");
        var table_len=(table.rows.length);
        var row = table.insertRow(table_len).outerHTML=
            "<tr id='row"+table_len+"'>"+
            "<td id='course_code_row"+table_len+"'>"+new_course_code+"</td>"+
            "<td id='section_row"+table_len+"'>"+new_section+"</td>"+
            "<td id='semester_row"+table_len+"'>"+new_semester+"</td>"+
            "<td id='schedule_row"+table_len+"'>"+new_schedule+"</td>"+
            "<td id='number_of_students_row"+table_len+"'>"+new_number_students+"</td>"+
            "<td id='syllabus_row"+table_len+"'>"+new_syllabus+"</td>"+
            "<td id='set_row"+table_len+"'>"+new_set+"</td>"+
            "<td id='action_button_row"+table_len+"'>"+
                "<button class='btn btn-primary crud-btn' id='edit_button"+table_len+"' style='margin-right: 20px;' onclick='edit_row("+table_len+")'>Edit</button>"+
                "<button class='btn btn-primary crud-btn' id='save_button"+table_len+"' style='margin-right: 20px; display:none;'' onclick='save_row("+table_len+")'>Save</button></td>"+
            "</tr>";

        document.getElementById("new_course_code").value="";
        document.getElementById("new_section").value="";
        document.getElementById("new_semester").value="";
        document.getElementById("new_schedule").value="";
        document.getElementById("new_number_students").value="";
        document.getElementById("new_syllabus").value="";
        document.getElementById("new_set").value="";
    }

    $('th.sortable').click(function(){
        var table = $(this).parents('table').eq(0)
        var rows = table.find('tr:gt(0)').toArray().sort(comparer($(this).index()))
        this.asc = !this.asc
        if (!this.asc){rows = rows.reverse()}
        for (var i = 0; i < rows.length; i++){table.append(rows[i])}
    })
    
    function comparer(index) {
        return function(a, b) {
            var valA = getCellValue(a, index), valB = getCellValue(b, index)
            return $.isNumeric(valA) && $.isNumeric(valB) ? valA - valB : valA.toString().localeCompare(valB)
        }
    }

    function getCellValue(row, index) { 
        return $(row).children('td').eq(index).text()
    }

    //$(document).ready(function(){
    //    $("h4.header").click(function(){
    //        $("table").toggle();
    //    });
    //});

    function header_click(index){
        curr_table = "#fsr_table" + index
        $(curr_table).toggle();
    }
</script>



{% endblock %}